//
//  MarketDataModel.swift
//  SwiftuiCrypto
//
//  Created by KSH on 12/11/23.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response
 {
   "data": {
     "active_cryptocurrencies": 11380,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 940,
     "total_market_cap": {
       "btc": 39048748.54167006,
       "eth": 734723120.3996147,
       "ltc": 22488786999.744587,
       "bch": 7026716305.675068,
       "bnb": 6770829154.914857,
       "eos": 2114989157435.9167,
       "xrp": 2639545651704.2397,
       "xlm": 13066466049945.67,
       "link": 110108047105.47987,
       "dot": 243758060834.48734,
       "yfi": 189102338.463114,
       "usd": 1648891629743.508,
       "aed": 6054944420330.024,
       "ars": 600045514753352.1,
       "aud": 2513938103214.4375,
       "bdt": 181371874492583.2,
       "bhd": 621638739979.8208,
       "bmd": 1648891629743.508,
       "brl": 8158386005644.94,
       "cad": 2239112388610.197,
       "chf": 1452792246001.3733,
       "clp": 1440850972818770.2,
       "cny": 11833105891691.295,
       "czk": 37309304368151.734,
       "dkk": 11425829659144.658,
       "eur": 1532427116151.4631,
       "gbp": 1310816081113.9377,
       "hkd": 12871041950324.115,
       "huf": 584318666700434.9,
       "idr": 25840090081566960,
       "ils": 6123091462495.686,
       "inr": 137473859696853.62,
       "jpy": 241391688652977.56,
       "krw": 2176668887325183,
       "kwd": 508547858662.2315,
       "lkr": 539596082422963.4,
       "mmk": 3462520668369115,
       "mxn": 28719246778298.117,
       "myr": 7720935056273.993,
       "ngn": 1301816430598795.2,
       "nok": 18050609591122.863,
       "nzd": 2695809201083.5156,
       "php": 91633035040595.88,
       "pkr": 468020514731591.7,
       "pln": 6639682614527.811,
       "rub": 149705369135231.97,
       "sar": 6184176301811.167,
       "sek": 17296576395516.023,
       "sgd": 2214461458745.5293,
       "thb": 58832453349248.5,
       "try": 47806150131990.68,
       "twd": 51910404638693.38,
       "uah": 60820315875776.43,
       "vef": 165103518886.2173,
       "vnd": 39997376544294590,
       "zar": 31483346475119.082,
       "xdr": 1240274848301.8782,
       "xag": 71839306258.65617,
       "xau": 826243106.7481756,
       "bits": 39048748541670.06,
       "sats": 3904874854167006
     },
     "total_volume": {
       "btc": 2323105.1855703117,
       "eth": 43710468.44529031,
       "ltc": 1337912728.2540684,
       "bch": 418036472.27837807,
       "bnb": 402813122.2594268,
       "eos": 125825857743.46114,
       "xrp": 157033001569.31055,
       "xlm": 777355899263.0646,
       "link": 6550595979.556086,
       "dot": 14501760909.056324,
       "yfi": 11250158.826942623,
       "usd": 98096580263.33252,
       "aed": 360223395282.391,
       "ars": 35698169569100.9,
       "aud": 149560302490.82288,
       "bdt": 10790254691535.049,
       "bhd": 36982803145.597374,
       "bmd": 98096580263.33252,
       "brl": 485362259826.9173,
       "cad": 133210251168.5924,
       "chf": 86430150165.77498,
       "clp": 85719734731507.89,
       "cny": 703980298601.7786,
       "czk": 2219621413863.8174,
       "dkk": 679750443276.736,
       "eur": 91167822606.17274,
       "gbp": 77983642218.78096,
       "hkd": 765729643463.0413,
       "huf": 34762541062967.836,
       "idr": 1537289913402300.8,
       "ils": 364277628848.0938,
       "inr": 8178654842198.62,
       "jpy": 14360979662763.93,
       "krw": 129495335145468.61,
       "kwd": 30254751091.656384,
       "lkr": 32101885566256.34,
       "mmk": 205993790332330.34,
       "mxn": 1708577959806.8623,
       "myr": 459337237083.05554,
       "ngn": 77448231083703.55,
       "nok": 1073874741442.5919,
       "nzd": 160380257197.28812,
       "php": 5451472500973.781,
       "pkr": 27843680664080.67,
       "pln": 395010895058.275,
       "rub": 8906337138427.047,
       "sar": 367911714760.5294,
       "sek": 1029015469577.9094,
       "sgd": 131743707293.65546,
       "thb": 3500085983795.7124,
       "try": 2844104341916.781,
       "twd": 3088276441753.648,
       "uah": 3618348768546.6733,
       "vef": 9822410581.767475,
       "vnd": 2379541376597600,
       "zar": 1873020984972.3362,
       "xdr": 73786972418.53519,
       "xag": 4273895352.0921273,
       "xau": 49155215.40415336,
       "bits": 2323105185570.3115,
       "sats": 232310518557031.2
     },
     "market_cap_percentage": {
       "btc": 50.1088555478791,
       "eth": 16.36568088611614,
       "usdt": 5.487862444798779,
       "bnb": 2.273570112428257,
       "xrp": 2.0442044232249783,
       "sol": 1.7868704850412147,
       "usdc": 1.481545123700774,
       "steth": 1.2567529102197132,
       "ada": 1.1704709142089103,
       "doge": 0.8491429458955488
     },
     "market_cap_change_percentage_24h_usd": -3.2388418729496578,
     "updated_at": 1702298952
   }
 }
 */


struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]?
    let marketCapChangePercentage24HUsd: Double?
    
    enum CoingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap?.first(where: { $0.key == "krw" }) {
            return "\(item.value)"
        }
        
        return "₩2.58조"
    }
    
    var vloume: String {
        if let item = totalVolume?.first(where: { $0.key == "krw" }) {
            return "\(item.value)"
        }
        
        return "₩342.74억"
    }
    
    var btcDominace: String {
        if let item = marketCapPercentage?.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        
        return "42.64%"
    }
}
